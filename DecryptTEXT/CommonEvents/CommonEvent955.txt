CommonEvent 955
Name = "Crystal Charge"

  ControlSwitches([1739, 1739, 0])
  Script(["@ch = 0"])
  Script(["@lim = 317 - $game_party.members[0].agi"])
  Script(["@win=Window_Base.new(232,110,500,500)"])
  ScriptMore(["@win.z = 1"])
  ScriptMore(["@win.opacity = 0"])
  Script(["@pic1=Bitmap.new(\"Graphics/Pictures/Ym.png\")"])
  ScriptMore(["@src1=Rect.new(0,0,5,42)"])
  Loop([])
    ConditionalBranch([12, "@ch >= @lim"])
      Empty([])

    Else([])
      ConditionalBranch([12, "@ch <= (@lim/3)"])
        ShowAnimation([-1, 161, false])
        Empty([])

      Else([])
        ConditionalBranch([12, "@ch <= (@lim/2)"])
          ShowAnimation([-1, 163, false])
          Empty([])

        Else([])
          ShowAnimation([-1, 164, false])
          Empty([])

        BranchEnd([])
        Empty([])

      BranchEnd([])
      Empty([])

    BranchEnd([])
    Wait([5])
    Script(["@ch += 8"])
    Comment(["Curr Charge"])
    ConditionalBranch([12, "@ch > 0"])
      ShowPicture([2, "CBi", 0, 0, 224, 116, 100, 100, 255, 0])
      Comment(["Width calc"])
      ConditionalBranch([12, "@ch >= @lim"])
        Script(["@ch = @lim"])
        ShowPicture([3, "CBe", 0, 0, 561, 116, 100, 100, 255, 0])
        Empty([])

      BranchEnd([])
      Script(["@wid = (@ch * 317) / @lim"])
      Script(["@ret1=Rect.new(0,0,@wid,42)"])
      Script(["@win.contents.stretch_blt(@ret1,@pic1,@src1)"])
      Empty([])

    BranchEnd([])
    ShowPicture([4, "CrystalBar", 0, 0, 224, 116, 100, 100, 255, 0])
    Script(["@press = 0"])
    ScriptMore(["if (Keys.press?(:L_CTRL))"])
    ScriptMore(["  @press = 1"])
    ScriptMore(["elsif WolfPad.press?(:Y,0) || WolfPad.press?(:Y,1)"])
    ScriptMore(["  @press = 1"])
    ScriptMore(["end "])
    ConditionalBranch([12, "@press == 0"])
      BreakLoop([])
      Empty([])

    BranchEnd([])
    Empty([])

  RepeatAbove([])
  ConditionalBranch([12, "@ch >= @lim"])
    ShowAnimation([-1, 162, false])
    Comment(["### CRYSTAL BOMB ###"])
    Script(["@id = 1"])
    ScriptMore(["while @id <= 250"])
    ScriptMore(["if $game_map.events[@id]"])
    ScriptMore(["@hpEnemy = $game_map.events[@id].enemy.hp rescue -1"])
    ScriptMore(["@mpEnemy = $game_map.events[@id].enemy.mp rescue 666"])
    ScriptMore(["@xEne = $game_map.events[@id].screen_x"])
    ScriptMore(["@yEne = $game_map.events[@id].screen_y"])
    ScriptMore(["if @xEne >= 0 && @yEne >= 0 && @xEne <= 800 && @yEne <= 608"])
    ScriptMore(["if @hpEnemy != -1 && @mpEnemy != 666 "])
    ScriptMore(["$game_variables[1495] = \"RockHoly\""])
    ScriptMore(["@mdf = $game_party.members[0].mdf"])
    ScriptMore(["@cryDmg = @mdf * @mdf * 2"])
    ScriptMore(["$game_map.events[@id].damage_enemy(@cryDmg)"])
    ScriptMore(["$game_map.events[@id].animation_id = 208"])
    ScriptMore(["end"])
    ScriptMore(["end"])
    ScriptMore(["end"])
    ScriptMore(["@id += 1"])
    ScriptMore(["end"])
    Comment(["### CRYSTAL BOMB ###"])
    Empty([])

  BranchEnd([])
  Script(["@win.contents.clear"])
  Script(["@win.dispose"])
  ErasePicture([1])
  ErasePicture([2])
  ErasePicture([3])
  ErasePicture([4])
  ControlSwitches([1739, 1739, 1])
  ControlSwitches([3694, 3694, 1])
  Empty([])
